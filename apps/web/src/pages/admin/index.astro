---
import { inlineCSS } from "../../styles/inline.css.ts";

// Admin-specific CSS (inline to prevent external CSS file generation)
const adminCSS = `:root {
  --admin-background: hsl(230 58% 6%);
  --admin-background-alt: hsl(236 43% 9%);
  --admin-card: hsl(235 46% 13%);
  --admin-card-border: hsl(231 38% 22%);
  --admin-primary: hsl(210 40% 98%);
  --admin-muted-foreground: hsl(215 20% 70%);
  --admin-secondary: hsl(235 45% 18%);
  --admin-accent: hsl(202 100% 53%);
  --admin-accent-soft: hsl(202 70% 25%);
  --admin-destructive: hsl(0 84.2% 60.2%);
  --admin-muted: hsl(235 46% 16%);
  --admin-border: hsl(231 38% 22%);
  --admin-input: hsl(235 40% 20%);
  --admin-ring: hsl(202 100% 60% / 0.65);
  --admin-success: hsl(146 51% 46%);
  --admin-warning: hsl(45 97% 63%);
}

.admin-page {
  min-height: 100vh;
  background: #0b0d0e;
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(67, 213, 255, 0.08) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(67, 213, 255, 0.05) 0%, transparent 50%);
  color: var(--text-primary);
  position: relative;
  overflow-x: hidden;
  cursor: default;
}

.admin-page::before,
.admin-page::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

.admin-page::before {
  background: radial-gradient(45% 60% at 20% 20%, hsl(202 98% 60% / 0.15), transparent 70%);
}

.admin-page::after {
  background: radial-gradient(35% 55% at 85% 15%, hsl(280 90% 60% / 0.12), transparent 60%);
}

/* Login Screen */
.login-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 60vh;
  position: relative;
  z-index: 1;
}

.login-card {
  position: relative;
  width: 100%;
  max-width: 420px;
  margin: 0 auto;
  background: var(--surface-elevated);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 2.5rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  overflow: hidden;
}

.login-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(120% 120% at 15% 0%, hsl(202 92% 53% / 0.15), transparent 55%);
  opacity: 0.8;
  pointer-events: none;
}

.login-brand {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.75rem;
}

.login-logo {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 0.8rem;
  background: linear-gradient(135deg, var(--admin-accent) 0%, hsl(212 100% 65%) 100%);
  color: hsl(210 40% 98%);
  font-family: var(--font-mono);
  font-size: 1rem;
  font-weight: 600;
  box-shadow: 0 10px 20px hsl(202 98% 50% / 0.35);
}

.login-badge {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  color: var(--admin-muted-foreground);
  display: inline-block;
}

.login-brand-name {
  font-weight: 600;
  font-size: 1rem;
  color: hsl(210 25% 90%);
  letter-spacing: 0.18em;
  text-transform: uppercase;
  margin-top: 0.25rem;
}

.login-header {
  margin-bottom: 2rem;
  position: relative;
  z-index: 1;
}

.login-title {
  font-size: clamp(1.9rem, 2vw + 1rem, 2.3rem);
  font-weight: 700;
  color: var(--admin-primary);
  margin-bottom: 0.5rem;
  letter-spacing: -0.02em;
}

.login-description {
  color: var(--admin-muted-foreground);
  font-size: 0.95rem;
  line-height: 1.5;
}

.login-form-group {
  margin-bottom: 1.75rem;
}

.login-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  margin-bottom: 0.5rem;
  color: var(--admin-primary);
}

.login-input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: color-mix(in srgb, var(--admin-background) 70%, transparent);
  border: 1px solid color-mix(in srgb, var(--admin-border) 60%, transparent);
  border-radius: 0.5rem;
  color: var(--admin-primary);
  font-size: 0.95rem;
  transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
}

.login-input:focus {
  outline: none;
  border-color: var(--admin-ring);
  box-shadow: 0 0 0 4px hsl(202 100% 60% / 0.12);
  transform: translateY(-1px);
}

.login-input::placeholder {
  color: hsl(215 20% 55%);
}

.login-button {
  width: 100%;
  padding: 0.85rem 1rem;
  background: linear-gradient(135deg, var(--admin-accent) 0%, hsl(214 100% 74%) 100%);
  color: var(--admin-background);
  border: none;
  border-radius: 0.65rem;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
  box-shadow: 0 14px 30px hsl(202 98% 50% / 0.35);
}

.login-button:hover:not(:disabled) {
  transform: translateY(-1px);
  filter: brightness(1.05);
}

.login-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  box-shadow: none;
}

.login-hint {
  margin-top: 1rem;
  font-size: 0.8rem;
  color: var(--admin-muted-foreground);
  text-align: center;
}

.login-error {
  margin-top: 1rem;
  padding: 0.75rem;
  background: hsl(0 84.2% 60.2% / 0.1);
  border: 1px solid hsl(0 84.2% 60.2% / 0.2);
  border-radius: 0.375rem;
  color: var(--admin-destructive);
  font-size: 0.875rem;
}

/* Admin Content */

.admin-header {
  margin-bottom: 2rem;
  width: 100%;
}

.admin-hero {
  background: var(--surface-elevated);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: clamp(2.25rem, 3vw + 1rem, 2.75rem);
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  justify-content: space-between;
  gap: 2.5rem;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  transition: all 0.3s ease;
}

.admin-hero:hover {
  border-color: var(--border-strong);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

.admin-hero::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(70% 70% at 100% 0%, hsl(202 98% 60% / 0.15), transparent 60%);
  opacity: 1;
  pointer-events: none;
  border-radius: 1.25rem;
}

.admin-hero-content {
  position: relative;
  z-index: 1;
  max-width: 580px;
}

.admin-eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.35rem 0.75rem;
  background: color-mix(in srgb, var(--admin-accent) 18%, transparent);
  border: 1px solid color-mix(in srgb, var(--admin-accent) 30%, transparent);
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--admin-accent);
  margin-bottom: 1.25rem;
}

.admin-title {
  font-size: clamp(2rem, 3vw + 1rem, 2.5rem);
  font-weight: 700;
  color: var(--admin-primary);
  letter-spacing: -0.02em;
  margin: 0 0 1rem;
  line-height: 1.1;
}

.admin-description {
  color: var(--admin-muted-foreground);
  font-size: 0.95rem;
  line-height: 1.7;
  max-width: 520px;
}

.admin-hero-actions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 0.75rem;
  position: relative;
  z-index: 1;
  min-width: 160px;
}

.admin-hero-actions p {
  margin: 0;
  font-size: 0.85rem;
  color: var(--admin-muted-foreground);
}

.admin-metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.metric-card {
  background: var(--surface-elevated);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 2rem;
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  transition: all 0.3s ease;
}

.metric-card:hover {
  transform: translateY(-2px);
  border-color: var(--border-strong);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

.metric-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(110% 110% at 20% 10%, hsl(202 96% 58% / 0.18), transparent 60%);
  pointer-events: none;
}

.metric-label {
  color: var(--admin-muted-foreground);
  font-size: 0.78rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.metric-value {
  margin-top: 0.75rem;
  font-size: 1.85rem;
  font-weight: 600;
  letter-spacing: -0.02em;
}

.metric-footnote {
  margin-top: 0.75rem;
  font-size: 0.78rem;
  color: hsl(213 20% 68%);
  display: flex;
  align-items: center;
  gap: 0.35rem;
}

.metric-chip {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.3rem 0.6rem;
  border-radius: 999px;
  background: color-mix(in srgb, var(--admin-accent) 18%, transparent);
  color: var(--admin-accent);
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.admin-card {
  background: var(--surface-elevated);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 2.25rem;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  transition: all 0.3s ease;
}

.admin-card:hover {
  border-color: var(--border-strong);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
}

.admin-card-header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 1rem;
  justify-content: space-between;
  margin-bottom: 1.75rem;
}

.admin-card-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--admin-primary);
}

.admin-card-subtitle {
  margin-top: 0.35rem;
  font-size: 0.85rem;
  color: var(--admin-muted-foreground);
}

#last-refresh {
  color: var(--admin-accent);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-left: 0.25rem;
}

.button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.55rem 1.1rem;
  border-radius: 0.65rem;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s, background 0.2s, color 0.2s;
  border: none;
  font-family: inherit;
}

.button-secondary {
  background: linear-gradient(135deg, 
    color-mix(in srgb, var(--admin-secondary) 95%, transparent) 0%,
    color-mix(in srgb, var(--admin-secondary) 85%, transparent) 100%);
  color: var(--admin-primary);
  border: 1px solid color-mix(in srgb, var(--admin-border) 70%, transparent);
  box-shadow: 
    0 4px 12px hsl(230 60% 5% / 0.3),
    0 0 0 1px color-mix(in srgb, var(--admin-ring) 8%, transparent) inset;
}

.button-secondary:hover:not(:disabled) {
  transform: translateY(-1px);
  background: linear-gradient(135deg, 
    color-mix(in srgb, var(--admin-secondary) 100%, var(--admin-accent) 8%) 0%,
    color-mix(in srgb, var(--admin-secondary) 95%, var(--admin-accent) 5%) 100%);
  border-color: color-mix(in srgb, var(--admin-border) 85%, transparent);
  box-shadow: 
    0 6px 16px hsl(230 60% 5% / 0.35),
    0 0 0 1px color-mix(in srgb, var(--admin-ring) 15%, transparent) inset;
}

.button-destructive {
  background: color-mix(in srgb, var(--admin-destructive) 14%, transparent);
  color: var(--admin-destructive);
  border: 1px solid color-mix(in srgb, var(--admin-destructive) 25%, transparent);
  box-shadow: 
    0 4px 12px hsl(0 84% 45% / 0.25),
    0 0 0 1px color-mix(in srgb, var(--admin-destructive) 10%, transparent) inset;
}

.button-destructive:hover:not(:disabled) {
  transform: translateY(-1px);
  background: color-mix(in srgb, var(--admin-destructive) 20%, transparent);
  border-color: color-mix(in srgb, var(--admin-destructive) 32%, transparent);
  box-shadow: 
    0 6px 16px hsl(0 84% 45% / 0.3),
    0 0 0 1px color-mix(in srgb, var(--admin-destructive) 15%, transparent) inset;
}

.button:disabled {
  opacity: 0.45;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.admin-status {
  margin-bottom: 1.25rem;
  padding: 0.85rem 1rem;
  border-radius: 0.75rem;
  background: color-mix(in srgb, var(--admin-muted) 90%, transparent);
  border: 1px solid color-mix(in srgb, var(--admin-border) 70%, transparent);
  color: var(--admin-muted-foreground);
  font-size: 0.85rem;
  text-align: center;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.admin-status.error-state {
  background: color-mix(in srgb, var(--admin-destructive) 12%, transparent);
  border-color: color-mix(in srgb, var(--admin-destructive) 24%, transparent);
  color: var(--admin-destructive);
}

.admin-table-wrapper {
  overflow-x: auto;
  border-radius: 0.875rem;
  border: 1px solid color-mix(in srgb, var(--admin-border) 60%, transparent);
  background: color-mix(in srgb, var(--admin-background-alt) 95%, transparent);
  box-shadow: 
    inset 0 2px 4px hsl(230 70% 5% / 0.2),
    inset 0 0 0 1px color-mix(in srgb, var(--admin-card-border) 30%, transparent);
}

.admin-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 0.9rem;
}

.admin-table thead {
  position: sticky;
  top: 0;
  background: color-mix(in srgb, var(--admin-muted) 95%, transparent);
  z-index: 1;
}

.admin-table th {
  padding: 0.9rem 1.1rem;
  text-align: left;
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--admin-muted-foreground);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.admin-table th:last-child {
  text-align: right;
}

.admin-table tbody tr {
  transition: background 0.15s ease, transform 0.15s ease;
}

.admin-table td {
  padding: 0.85rem 1.1rem;
  border-top: 1px solid color-mix(in srgb, var(--admin-border) 55%, transparent);
  color: var(--admin-primary);
}

.admin-table td:last-child {
  text-align: right;
}

.admin-table tbody tr:hover {
  background: color-mix(in srgb, var(--admin-accent-soft) 50%, transparent);
  transform: translateX(2px);
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.3rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.78rem;
  font-weight: 600;
  background: color-mix(in srgb, var(--admin-accent) 16%, transparent);
  color: var(--admin-accent);
  text-decoration: none;
}

.badge::before {
  content: "‚óè";
  font-size: 0.5rem;
}

.badge-mono {
  font-family: var(--font-mono);
  background: color-mix(in srgb, var(--admin-secondary) 88%, transparent);
  color: var(--admin-primary);
  letter-spacing: 0.04em;
}

.badge-mono::before {
  display: none;
}

.table-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.2rem 0.6rem;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.table-pill.never {
  background: color-mix(in srgb, var(--admin-secondary) 65%, transparent);
  color: var(--admin-muted-foreground);
  border: 1px solid color-mix(in srgb, var(--admin-border) 60%, transparent);
}

.table-pill.expired {
  background: color-mix(in srgb, var(--admin-destructive) 22%, transparent);
  color: var(--admin-destructive);
  border: 1px solid color-mix(in srgb, var(--admin-destructive) 32%, transparent);
}

.table-pill.warning {
  background: color-mix(in srgb, var(--admin-warning) 28%, transparent);
  color: var(--admin-warning);
  border: 1px solid color-mix(in srgb, var(--admin-warning) 38%, transparent);
}

.table-pill.active {
  background: color-mix(in srgb, var(--admin-success) 28%, transparent);
  color: var(--admin-success);
  border: 1px solid color-mix(in srgb, var(--admin-success) 38%, transparent);
}

.empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--admin-muted-foreground);
}

.error-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--admin-destructive);
}

.link-target {
  max-width: 320px;
}

.link-target-anchor {
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--admin-primary);
  text-decoration: none;
}

.link-target-anchor:hover {
  color: var(--admin-accent);
}

@media (max-width: 1024px) {
  .admin-wrapper {
    padding: 2.5rem 1.5rem 3.5rem;
  }

  .admin-hero {
    flex-direction: column;
    align-items: flex-start;
  }

  .admin-hero-actions {
    width: 100%;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }
}

@media (max-width: 768px) {
  .admin-wrapper {
    padding: 2.25rem 1.25rem 3rem;
  }

  .admin-hero {
    padding: 1.6rem;
  }

  .admin-metrics {
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
  }

  .admin-card {
    padding: 1.25rem;
  }

  .admin-table {
    font-size: 0.82rem;
  }

  .admin-table th,
  .admin-table td {
    padding: 0.65rem 0.8rem;
  }
}`;
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>sakla ‚Äî Admin</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîó</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style set:html={inlineCSS} is:global></style>
    <style set:html={adminCSS} is:global></style>
  </head>
  <body class="admin-page" style="cursor: default;">
    <div class="page">
      <nav class="nav">
        <a href="/" class="logo" title="Ana sayfaya git">sakla.dev</a>
        <div class="nav-actions">
          <a class="nav-link" href="/" title="Ana sayfaya git">Ana sayfa</a>
        </div>
      </nav>

      <div id="login-screen" style="display: none;">
        <main class="main-content">
          <div class="content-wrapper">
            <div class="form-card">
              <div class="login-brand">
                <span class="login-logo">sa</span>
                <div>
                  <div class="login-badge">Y√∂netim Konsolu</div>
                  <div class="login-brand-name">sakla.dev</div>
                </div>
              </div>
              <div class="login-header">
                <h1 class="login-title">Tekrar ho≈ü geldiniz</h1>
                <p class="login-description">Y√∂netim paneline eri≈ümek i√ßin ≈üifrenizi girin</p>
              </div>
          <form id="login-form">
            <div class="login-form-group">
                  <label for="admin-password" class="login-label">≈ûifre</label>
                  <input
                    id="admin-password"
                    type="password"
                    class="login-input"
                    placeholder="Y√∂netici ≈üifresini girin"
                    required
                    autocomplete="current-password"
                  />
                </div>
                <button type="submit" class="login-button" id="login-button">
                  Giri≈ü yap
                </button>
                <p class="login-hint">Cloudflare Access ile korunur ¬∑ Bu sekmeyi kapattƒ±ƒüƒ±nƒ±zda oturum sƒ±fƒ±rlanƒ±r</p>
                <div id="login-error" class="login-error" style="display: none;"></div>
              </form>
            </div>
          </div>
        </main>
      </div>

      <div id="admin-content" style="display: none;">
        <main class="main-content">
          <div class="content-wrapper">
        <header class="admin-header">
          <div class="admin-hero">
            <div class="admin-hero-content">
              <span class="admin-eyebrow">
                <span class="material-icons" style="font-size: 1rem;">bolt</span>
                Baƒülantƒ± Operasyon Merkezi
              </span>
              <h1 class="admin-title">Baƒülantƒ± panosu</h1>
              <p class="admin-description">
                Performansƒ± izleyin, eskimi≈ü y√∂nlendirmeleri temizleyin ve kƒ±sa baƒülantƒ±larƒ±nƒ±zƒ± formda tutun.
              </p>
            </div>
            <div class="admin-hero-actions">
              <button id="refresh" type="button" class="button button-secondary">
                <span class="material-icons" style="font-size: 1rem;">refresh</span>
                Verileri yenile
              </button>
              <p>Son senkronizasyon <span id="last-refresh">hi√ß</span></p>
            </div>
          </div>
        </header>

        <div id="admin-metrics" class="admin-metrics"></div>

          <div class="admin-card">
            <div class="admin-card-header">
              <div>
                <h2 class="admin-card-title">Son baƒülantƒ±lar</h2>
                <p class="admin-card-subtitle">Olu≈üturulma tarihine g√∂re sƒ±ralanan son 50 kaydƒ± g√∂steriyoruz</p>
              </div>
            </div>

          <div id="admin-status" class="admin-status" style="display: none;"></div>

          <div class="admin-table-wrapper">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Kƒ±saltma</th>
                  <th>Hedef</th>
                  <th>Tƒ±klama</th>
                  <th>Sona erme</th>
                  <th>ƒ∞≈ülemler</th>
                </tr>
              </thead>
              <tbody id="links-body"></tbody>
            </table>
          </div>
        </div>
        </main>
      </div>
    </div>

    <script is:inline>
      console.log('Admin script loading...');
      (function() {
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
        } else {
          init();
        }
        
        function init() {
          const loginScreen = document.getElementById('login-screen');
          const adminContent = document.getElementById('admin-content');
          const loginForm = document.getElementById('login-form');
          const loginError = document.getElementById('login-error');
          const loginButton = document.getElementById('login-button');
          const passwordInput = document.getElementById('admin-password');
          const status = document.getElementById('admin-status');
          const body = document.getElementById('links-body');
          const refresh = document.getElementById('refresh');

          // Check if already authenticated
          const token = sessionStorage.getItem('admin_token');
          if (token) {
            verifyToken(token);
          } else {
            showLogin();
          }

          if (loginForm) {
            loginForm.addEventListener('submit', handleLogin);
          }

          async function handleLogin(e) {
            e.preventDefault();
            if (!passwordInput) return;

            const password = passwordInput.value;
            if (!password) return;

            if (loginButton) {
              loginButton.disabled = true;
              loginButton.textContent = 'Giri≈ü yapƒ±lƒ±yor...';
            }

            try {
              const response = await fetch('/api/admin-auth', {
                method: 'POST',
                headers: { 'content-type': 'application/json' },
                body: JSON.stringify({ password }),
              });

              const data = await response.json();

              if (!response.ok) {
                showError(data.error === 'invalid_password' ? '≈ûifre yanlƒ±≈ü. L√ºtfen tekrar deneyin.' : 'Kimlik doƒürulamasƒ± ba≈üarƒ±sƒ±z oldu');
                if (loginButton) {
                  loginButton.disabled = false;
                  loginButton.textContent = 'Giri≈ü yap';
                }
                return;
              }

              if (data.token) {
                sessionStorage.setItem('admin_token', data.token);
                showAdmin();
                loadLinks();
              }
            } catch (error) {
              console.error('Login error:', error);
              showError('Kimlik doƒürulamasƒ± ba≈üarƒ±sƒ±z oldu. L√ºtfen tekrar deneyin.');
              if (loginButton) {
                loginButton.disabled = false;
                loginButton.textContent = 'Giri≈ü yap';
              }
            }
          }

          async function verifyToken(token) {
            try {
              const response = await fetch('/api/admin-auth', {
                headers: { 'Authorization': `Bearer ${token}` },
              });

              const data = await response.json();
              if (data.authenticated) {
                showAdmin();
                loadLinks();
              } else {
                sessionStorage.removeItem('admin_token');
                showLogin();
              }
            } catch (error) {
              console.error('Token verification error:', error);
              sessionStorage.removeItem('admin_token');
              showLogin();
            }
          }

          function showLogin() {
            if (loginScreen) loginScreen.style.display = '';
            if (adminContent) adminContent.style.display = 'none';
            if (passwordInput) passwordInput.value = '';
            if (loginError) loginError.style.display = 'none';
          }

          function showAdmin() {
            if (loginScreen) loginScreen.style.display = 'none';
            if (adminContent) adminContent.style.display = '';
            if (loginError) loginError.style.display = 'none';
          }

          function showError(message) {
            if (loginError) {
              loginError.textContent = message;
              loginError.style.display = '';
            }
          }

          function setStatus(message, isError = false) {
            if (status) {
              const translated = translateStatusMessage(message);
              status.textContent = translated;
              status.style.display = translated ? 'block' : 'none';
              const normalized = translated.toLowerCase();
              const autoError =
                normalized.includes('hata') ||
                normalized.includes('error') ||
                normalized.includes('ba≈üarƒ±sƒ±z');
              status.className = isError || autoError ? 'admin-status error-state' : 'admin-status';
            }
          }

          function translateStatusMessage(input) {
            const original = (input ?? '').toString();
            const key = original.trim().toLowerCase();
            if (!key) return original;
            const map = new Map([
              ['loading links...', 'Baƒülantƒ±lar y√ºkleniyor...'],
              ['no links found.', 'Baƒülantƒ± bulunamadƒ±.'],
              ['no links found', 'Baƒülantƒ± bulunamadƒ±'],
              ['no links created yet.', 'Hen√ºz baƒülantƒ± olu≈üturulmadƒ±.'],
              ['link deleted successfully.', 'Baƒülantƒ± ba≈üarƒ±yla silindi.'],
              ['failed to load links', 'Baƒülantƒ±lar y√ºklenemedi'],
              ['failed to load metrics', 'Metrikler y√ºklenemedi'],
              ['error: link id not found', 'Hata: Baƒülantƒ± kimliƒüi bulunamadƒ±'],
              ['failed to delete link', 'Baƒülantƒ± silinemedi'],
              ['server returned empty response', 'Sunucu bo≈ü yanƒ±t d√∂nd√ºrd√º'],
              ['server returned non-json response', 'Sunucu JSON olmayan bir yanƒ±t d√∂nd√ºrd√º'],
              ['the delete endpoint was not found. the route may not be configured correctly.', 'Silme u√ß noktasƒ± bulunamadƒ±. Rota doƒüru yapƒ±landƒ±rƒ±lmamƒ±≈ü olabilir.'],
              ['delete was not successful', 'Silme i≈ülemi ba≈üarƒ±lƒ± olmadƒ±'],
              ['unknown error', 'Bilinmeyen hata'],
            ]);
            if (map.has(key)) {
              return map.get(key) ?? original;
            }
            if (key.startsWith('request failed')) {
              return original.replace(/request failed/i, 'ƒ∞stek ba≈üarƒ±sƒ±z');
            }
            if (key.startsWith('server returned non-json response')) {
              return original.replace(/Server returned non-JSON response/i, 'Sunucu JSON olmayan bir yanƒ±t d√∂nd√ºrd√º');
            }
            return original;
          }

          const metrics = document.getElementById('admin-metrics');
          const lastRefreshDisplay = document.getElementById('last-refresh');
          const numberFormatter = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 });
          const averageFormatter = new Intl.NumberFormat(undefined, { maximumFractionDigits: 1 });
          const timeFormatter = new Intl.DateTimeFormat(undefined, { hour: '2-digit', minute: '2-digit' });
          const formatInteger = (value) =>
            numberFormatter.format(Math.max(0, Math.round(Number(value) || 0)));
          const formatAverage = (value) =>
            averageFormatter.format(Math.max(0, Number(value) || 0));
          const refreshDefaultHTML = refresh ? refresh.innerHTML : '';

          async function loadLinks() {
            const token = sessionStorage.getItem('admin_token');
            if (!token) {
              showLogin();
              return;
            }

            setStatus('Baƒülantƒ±lar y√ºkleniyor...');
            if (body) body.innerHTML = '';
            if (metrics) {
              metrics.innerHTML = `
                <article class="metric-card">
                  <div class="metric-label">Pano</div>
                  <div class="metric-value">...</div>
                  <div class="metric-footnote">Son istatistikler alƒ±nƒ±yor</div>
                </article>`;
            }
            if (refresh) {
              if (!refresh.dataset.originalContent) {
                refresh.dataset.originalContent = refresh.innerHTML;
              }
              refresh.disabled = true;
              refresh.innerHTML = '<span class="material-icons" style="font-size: 1rem;">hourglass_top</span> G√ºncelleniyor...';
            }
            if (lastRefreshDisplay) {
              lastRefreshDisplay.textContent = 'g√ºncelleniyor...';
            }

            try {
              const response = await fetch('/api/links', {
                headers: {
                  accept: 'application/json',
                },
              });
              
              if (!response.ok) {
                if (response.status === 401) {
                  sessionStorage.removeItem('admin_token');
                  showLogin();
                  return;
                }
                const errorText = await response.text();
                console.error('API error:', response.status, errorText);
                throw new Error('Request failed: ' + response.status);
              }
              
              const payload = await response.json();
              console.log('API response:', payload);
              const items = Array.isArray(payload?.links) ? payload.links : [];
              const stats = typeof payload?.stats === 'object' && payload.stats !== null ? payload.stats : null;
              console.log('Links found:', items.length);

              const normalizeNumber = (value, fallback) => {
                const numberValue = typeof value === 'number' ? value : Number(value);
                return Number.isFinite(numberValue) ? numberValue : fallback;
              };

              const nowSeconds = Math.floor(Date.now() / 1000);
              const fallbackProtected = items.filter((link) => Boolean(link?.password_hash)).length;
              const fallbackLive = items.filter((link) => {
                const isActive = Number(link?.is_active) === 1;
                const expires = Number(link?.expires_at);
                const hasExpired = Number.isFinite(expires) && expires > 0 && expires <= nowSeconds;
                return isActive && !hasExpired;
              }).length;
              const fallbackExpired = items.filter((link) => {
                const expires = Number(link?.expires_at);
                return Number.isFinite(expires) && expires > 0 && expires <= nowSeconds;
              }).length;
              const fallbackInactive = items.filter((link) => Number(link?.is_active) === 0).length;
              const fallbackSoonExpiring = items.filter((link) => {
                const expires = Number(link?.expires_at);
                return (
                  Number.isFinite(expires) &&
                  expires > nowSeconds &&
                  expires <= nowSeconds + 7 * 24 * 60 * 60
                );
              }).length;
              const fallbackClicks = items.reduce(
                (sum, link) => sum + (Number(link?.clicks_total) || 0),
                0,
              );

              const totalLinks = normalizeNumber(stats?.total, items.length);
              const protectedCount = normalizeNumber(stats?.protected, fallbackProtected);
              const liveCount = normalizeNumber(stats?.live, fallbackLive);
              const expiredCount = normalizeNumber(stats?.expired, fallbackExpired);
              const inactiveCount = normalizeNumber(stats?.inactive, fallbackInactive);
              const soonExpiringCount = normalizeNumber(stats?.expiringSoon, fallbackSoonExpiring);
              const totalClicks = normalizeNumber(stats?.totalClicks, fallbackClicks);
              const averageClicks = totalLinks > 0 ? totalClicks / totalLinks : 0;
              const publicCount = Math.max(totalLinks - protectedCount, 0);
              const pausedCount = Math.max(totalLinks - liveCount, 0);
              const newestLink = items[0];

              if (metrics) {
                const latestSummary = escapeHtml(
                  newestLink && (newestLink.alias || newestLink.id)
                    ? `En yeni: ${newestLink.alias || newestLink.id}`
                    : 'En yeni: yok',
                );
                const metricsCards = [
                  {
                    label: 'Toplam baƒülantƒ±',
                    value: formatInteger(totalLinks),
                    footnote: totalLinks
                      ? `<span class="metric-chip">${formatInteger(protectedCount)} korumalƒ±</span><span>${formatInteger(publicCount)} herkese a√ßƒ±k</span>`
                      : 'Bu panoyu doldurmak i√ßin ilk kƒ±sa baƒülantƒ±nƒ±zƒ± olu≈üturun.',
                  },
                  {
                    label: 'Aktif baƒülantƒ±lar',
                    value: formatInteger(liveCount),
                    footnote: liveCount
                      ? `<span class="metric-chip">${formatInteger(soonExpiringCount)} yakƒ±nda sona erecek</span><span>${formatInteger(pausedCount)} durduruldu</span>`
                      : '≈ûu anda aktif baƒülantƒ± yok.',
                  },
                  {
                    label: 'S√ºresi dolmu≈ü / pasif',
                    value: formatInteger(expiredCount + inactiveCount),
                    footnote: expiredCount + inactiveCount
                      ? `<span class="metric-chip">${formatInteger(expiredCount)} s√ºresi dolmu≈ü</span><span>${formatInteger(inactiveCount)} devre dƒ±≈üƒ±</span>`
                      : 'Her ≈üey yolunda - s√ºresi dolan yok.',
                  },
                  {
                    label: 'Toplam tƒ±klama',
                    value: formatInteger(totalClicks),
                    footnote: totalClicks
                      ? `<span class="metric-chip">${formatAverage(averageClicks)} ort</span><span>baƒülantƒ± ba≈üƒ±na</span><span>${latestSummary}</span>`
                      : 'Hen√ºz trafik kaydedilmedi.',
                  },
                ];

                metrics.innerHTML = metricsCards
                  .map(
                    (card) => `
                      <article class="metric-card">
                        <div class="metric-label">${card.label}</div>
                        <div class="metric-value">${card.value}</div>
                        <div class="metric-footnote">${card.footnote}</div>
                      </article>`,
                  )
                  .join('');
              }
              
              if (items.length === 0) {
                setStatus('Baƒülantƒ± bulunamadƒ±.');
                if (body) {
                  body.innerHTML = '<tr><td colspan="5" class="empty-state">Hen√ºz baƒülantƒ± olu≈üturulmadƒ±.</td></tr>';
                }
                if (lastRefreshDisplay) {
                  lastRefreshDisplay.textContent = timeFormatter.format(new Date());
                }
                return;
              }

              const fragment = document.createDocumentFragment();
              for (const link of items) {
                const row = document.createElement('tr');
                const safeAlias = escapeHtml(link.alias || '');
                const safeId = escapeHtml(link.id || '');
                const safeTarget = escapeHtml(link.target || '');
                const safeTargetHref = escapeHtml(link.target || '');
                const clicksDisplay = formatInteger(link.clicks_total ?? 0);
                const aliasSlug = link.alias || link.id || '';
                const aliasHref = aliasSlug ? '/' + encodeURIComponent(aliasSlug) : null;
                const aliasCell = aliasHref
                  ? `<a href="${aliasHref}" class="badge badge-mono" target="_blank" rel="noopener">${safeAlias || safeId}</a>`
                  : `<span class="badge badge-mono">${safeAlias || safeId}</span>`;
                row.innerHTML = `
                  <td>${aliasCell}</td>
                  <td class="link-target" title="${safeTarget}">
                    ${
                      safeTarget
                        ? `<a href="${safeTargetHref}" target="_blank" rel="noopener" class="link-target-anchor">${safeTarget}</a>`
                        : '‚Äî'
                    }
                  </td>
                  <td style="text-align: right;">${clicksDisplay}</td>
                  <td style="text-align: right;">${formatExpiry(link.expires_at)}</td>
                  <td style="text-align: right;">
                    <button data-id="${safeId}" class="button button-destructive delete-btn">
                      <span class="material-icons" style="font-size: 1rem;">delete</span>
                      Sil
                    </button>
                  </td>`;
                fragment.appendChild(row);
              }

              if (body) {
                body.appendChild(fragment);
              }
              
              setStatus(`${items.length} baƒülantƒ± y√ºklendi.`);
              if (lastRefreshDisplay) {
                lastRefreshDisplay.textContent = timeFormatter.format(new Date());
              }
            } catch (error) {
              console.error('Load error:', error);
              setStatus('Baƒülantƒ±lar y√ºklenemedi: ' + (error.message || 'Bilinmeyen hata'), true);
              if (body) {
                body.innerHTML = '<tr><td colspan="5" class="error-state">Baƒülantƒ±lar y√ºklenirken hata olu≈ütu. Ayrƒ±ntƒ±lar i√ßin konsolu kontrol edin.</td></tr>';
              }
              if (metrics) {
                const message = escapeHtml(error?.message || 'Metrikler y√ºklenemedi');
                metrics.innerHTML = `
                  <article class="metric-card">
                    <div class="metric-label">Hata</div>
                    <div class="metric-value">!</div>
                    <div class="metric-footnote">${message}</div>
                  </article>`;
              }
              if (lastRefreshDisplay) {
                lastRefreshDisplay.textContent = 'ba≈üarƒ±sƒ±z';
              }
            } finally {
              if (refresh) {
                refresh.disabled = false;
                refresh.innerHTML = refresh.dataset.originalContent || refreshDefaultHTML || 'Yenile';
              }
            }
          }

          function escapeHtml(text) {
            if (text == null) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
          }

          function formatExpiry(expires) {
            if (!expires) {
              return '<span class="table-pill never">S√ºresiz</span>';
            }
            const value = Number(expires);
            if (!Number.isFinite(value) || value <= 0) {
              return '<span class="table-pill never">S√ºresiz</span>';
            }
            const date = new Date(value * 1000);
            const now = Date.now();
            const formattedDate = escapeHtml(date.toLocaleString());
            if (date.getTime() < now) {
              return `${formattedDate} <span class="table-pill expired">S√ºresi doldu</span>`;
            }
            const diffMs = date.getTime() - now;
            const diffDays = diffMs / (1000 * 60 * 60 * 24);
            if (diffDays <= 7) {
              const daysRemaining = Math.max(1, Math.ceil(diffDays));
              return `${formattedDate} <span class="table-pill warning">${daysRemaining} g√ºn i√ßinde</span>`;
            }
            return `${formattedDate} <span class="table-pill active">Aktif</span>`;
          }

          async function handleDelete(event) {
            const token = sessionStorage.getItem('admin_token');
            if (!token) {
              showLogin();
              return;
            }

            const target = event.target.closest('.delete-btn');
            if (!target) return;
            
            const id = target.getAttribute('data-id');
            if (!id) {
              console.error('Delete failed: no ID found');
              setStatus('Hata: Baƒülantƒ± kimliƒüi bulunamadƒ±', true);
              return;
            }
            
            if (!confirm('Bu baƒülantƒ±yƒ± silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz.')) {
              return;
            }

            target.disabled = true;
            const originalHTML = target.innerHTML;
            target.innerHTML = '<span class="material-icons" style="font-size: 1rem;">hourglass_empty</span> Siliniyor...';
            
            try {
              console.log('Deleting link:', id);
              const url = '/api/links/' + encodeURIComponent(id);
              console.log('Delete URL:', url);
              
              const response = await fetch(url, {
                method: 'DELETE',
                headers: {
                  'accept': 'application/json',
                },
              });
              
              console.log('Delete response status:', response.status);
              console.log('Delete response headers:', Object.fromEntries(response.headers.entries()));
              
              const contentType = response.headers.get('content-type') || '';
              console.log('Content-Type:', contentType);
              
              let result;
              const responseText = await response.text();
              console.log('Raw response text (first 500 chars):', responseText.substring(0, 500));
              console.log('Response text length:', responseText.length);
              
              // Try to parse as JSON
              if (responseText.trim()) {
                try {
                  result = JSON.parse(responseText);
                  console.log('Successfully parsed JSON:', result);
                } catch (parseError) {
                  console.error('Failed to parse as JSON:', parseError);
                  console.error('Response text:', responseText);
                  
                  // If it's HTML (404 page or error), provide better error
                  if (responseText.trim().startsWith('<!DOCTYPE') || responseText.trim().startsWith('<html')) {
                    result = { 
                      error: 'route_not_found', 
                      deleted: false,
                      message: 'Silme u√ß noktasƒ± bulunamadƒ±. Rota doƒüru yapƒ±landƒ±rƒ±lmamƒ±≈ü olabilir.',
                      status: response.status
                    };
                  } else {
                    result = { 
                      error: 'invalid_response', 
                      deleted: false,
                      message: 'Sunucu JSON olmayan bir yanƒ±t d√∂nd√ºrd√º: ' + responseText.substring(0, 200),
                      raw: responseText.substring(0, 200)
                    };
                  }
                }
              } else {
                result = { error: 'empty_response', deleted: false, message: 'Sunucu bo≈ü yanƒ±t d√∂nd√ºrd√º' };
              }
              
              console.log('Parsed result:', result);
              
              if (!response.ok) {
                if (response.status === 401) {
                  sessionStorage.removeItem('admin_token');
                  showLogin();
                  return;
                }
                throw new Error(result.error || result.message || `Silme ba≈üarƒ±sƒ±z (${response.status})`);
              }
              
              if (result.deleted === true) {
                setStatus('Baƒülantƒ± ba≈üarƒ±yla silindi.');
                setTimeout(() => setStatus(''), 3000);
                await loadLinks();
              } else {
                throw new Error(result.error || result.message || 'Silme i≈ülemi ba≈üarƒ±lƒ± olmadƒ±');
              }
            } catch (error) {
              console.error('Delete error:', error);
              setStatus('Baƒülantƒ± silinemedi: ' + (error.message || 'Bilinmeyen hata'), true);
              target.innerHTML = originalHTML;
              target.disabled = false;
            }
          }

          if (refresh) {
            refresh.addEventListener('click', loadLinks);
          }

          if (body) {
            body.addEventListener('click', handleDelete);
          }
        }
      })();
      console.log('Admin script setup complete');
    </script>
  </body>
</html>
